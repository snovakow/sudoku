<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="viewport" content="width=device-width,initial-scale=1">

	<script type="module">
		const body = document.createElement('div');

		body.style.fontFamily = "'Courier New', monospace";

		const generateButton = document.createElement('button');
		generateButton.appendChild(document.createTextNode("+"));
		generateButton.style.top = '8px';
		generateButton.style.right = '8px';
		generateButton.style.position = 'absolute';
		generateButton.style.width = '32px';
		generateButton.style.height = '32px';

		const dataStore = [];
		const writeData = (count) => {
			const link = document.createElement("a");
			const file = new Blob([dataStore.join('\n')], { type: 'text/plain' });
			link.href = URL.createObjectURL(file);
			link.download = `sudokus${count}.txt`;
			link.click();
			URL.revokeObjectURL(link.href);
			dataStore.length = 0;
		};

		let worker = null;
		generateButton.addEventListener('click', () => {
			if (worker) {
				worker.terminate();
				worker = null;
			} else {
				worker = new Worker("worker.js", { type: "module" });
				worker.postMessage({ search: window.location.search });
				worker.onmessage = (e) => {
					const data = e.data;
					dataStore.push(data.puzzle);
					if (data.totalPuzzles % 100000 === 0) {
						writeData(data.totalPuzzles);
					}

					if (data.message) {
						while (body.firstChild) body.removeChild(body.lastChild);
						for (const line of data.message) {
							const stat = document.createElement('div');
							stat.appendChild(document.createTextNode(line));
							body.appendChild(stat);
						}
					}
				};
			}
		});

		document.body.appendChild(generateButton);
		document.body.appendChild(body);
	</script>

</head>

<body></body>

</html>